#!/bin/zsh
SALT=`date +%g`
if [[ ARGC -gt 0 ]] then
  BINNAME=`basename $PWD`
  foreach USER ($@)
    mkdir -p obj/$USER
    TEMP=`echo $USER $SALT $BINNAME | sha512sum` 
    AA=`echo $TEMP | base64 | head -1 | cut -c 1-3`
    CC=`echo $TEMP | head -1 | cut -c 1-3`
    HH=`echo $TEMP | head -1 | cut -c 4-6 | tr "[:lower:]" "[:upper:]"`
    BB=`echo "ibase=16; num=$HH;ibase=A;num%1000" | bc`
    cat program.c.template | sed s/XYZ/$AA/ | sed s/123/$BB/ | sed s/ABC/$CC/ >! program.c
    gcc -m32 -o obj/$USER/$BINNAME program.c
  end
  rm program.c
else
  echo "USAGE: build.zsh <user_email(s)>"
fi
